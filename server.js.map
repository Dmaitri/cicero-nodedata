{"version":3,"sources":["server.ts"],"names":[],"mappings":";AACA,IAAI,QAAQ,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AACxC,MAAO,IAAI,WAAW,MAAM,CAAC,CAAC;AAC9B,MAAO,KAAK,WAAW,OAAO,CAAC,CAAC;AAChC,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC;AACzC,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;AACjC,0BAAuB,uBAAuB,CAAC,CAAA;AAG/C,MAAY,MAAM,WAAM,UAAU,CAAC,CAAA;AACnC,MAAY,cAAc,WAAM,mBAAmB,CAAC,CAAA;AACpD,MAAY,EAAE,WAAM,IAAI,CAAC,CAAA;AAGzB,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,EAAE,aAAa,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC,QAAQ,CAAC;AACvF,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;AAEzC,IAAI,IAAI,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AACpC,IAAI,OAAO,GAAG,OAAO,CAAC,uBAAuB,CAAC,CAAC;AAC/C,IAAI,CAAC,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,CAAC,gBAAgB,CAAC,CAAC;AAExE,iBAAiB;AACjB,wBAAwB;AAExB,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC;AACnC,OAAO,CAAC,cAAc,EAAE,CAAC;AAEzB,OAAO,CAAC,0BAA0B,CAAC,CAAC;AACpC,IAAI,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AACxC,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,OAAO,CAAC;AAE/B,IAAI,GAAG,GAAG,OAAO,EAAE,CAAC;AACpB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;AAEnB,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;AACvC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;AACpC,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,SAAS,GAAG,QAAQ,CAAC,CAAC;AACvC,GAAG,CAAC,GAAG,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;AAE9B,IAAI,cAAc,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;AAChD,GAAG,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,MAAM,EAAE,aAAa,EAAE,MAAM,EAAE,KAAK,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;AAC5F,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,MAAM,EAAC,CAAC,CAAC,CAAC;AAC1C,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC;IAC1B,KAAK,EAAE,MAAM;IACb,QAAQ,EAAE,IAAI;CACjB,CAAC,CAAC,CAAC;AACJ,GAAG,CAAC,GAAG,CAAC,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI;IAC5B,GAAG,CAAC,MAAM,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC;IAC/C,GAAG,CAAC,MAAM,CAAC,8BAA8B,EAAE,2BAA2B,CAAC,CAAC;IACxE,GAAG,CAAC,MAAM,CAAC,8BAA8B,EAAE,kHAAkH,CAAC,CAAC;IAC/J,GAAG,CAAC,MAAM,CAAC,kCAAkC,EAAE,MAAM,CAAC,CAAC;IACvD,GAAG,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;IACjC,EAAE,CAAC,CAAC,SAAS,KAAK,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;QAC3B,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAClB,CAAC;IAAC,IAAI,CAAC,CAAC;QACJ,IAAI,EAAE,CAAC;IACX,CAAC;AACL,CAAC,CAAC,CAAC;AAEH,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,UAAU,GAAQ,EAAE,GAAQ;IAC5C,EAAE,CAAC,QAAQ,CAAC,kBAAkB,EAAE,UAAU,GAA0B,EAAE,IAAY;QAC9E,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAI,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QACvC,YAAY,GAAG,YAAY,CAAC,SAAS,CAAC;QACtC,YAAY,CAAC,OAAO,CAAC,CAAC,GAAG,EAAC,KAAK;YAC3B,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,UAAU,QAAQ;gBACjC,IAAI,IAAI,GAAG,IAAI,MAAM,EAAE,CAAC;gBACxB,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,UAAU,KAAK;oBAC/B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBACrB,CAAC,CAAC,CAAC;gBACH,QAAQ,CAAC,EAAE,CAAC,KAAK,EAAE;oBACf,IAAI,GAAG,GAAG,GAAG,CAAC;oBACd,IAAI,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;oBACjD,IAAI,QAAQ,GAAG,kBAAkB,GAAG,KAAK,CAAC;oBAC1C,EAAE,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;gBAC5C,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;QACb,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AAEH,iEAAiE;AACjE,0CAA0C;AAC1C,SAAS;AAGT,QAAQ,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,EAAE;IAC5B,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;AACvB,CAAC,CAAC,CAAC;AAGH,QAAQ,CAAC,eAAe,CAAC,CAAC,EAAE,EAAE,EAAE;IAC5B,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,EAAE,CAAC;QACnC,IAAI,CACJ,CAAC,IAAI;QACD,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;IACnC,CAAC,EACD,CAAC,GAAG;QACA,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;IACnB,CAAC,CACA,CAAC;AAEV,CAAC,CAAC,CAAC;AAEH,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC;AAC/B,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC;AAC5B,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,gBAAM,CAAC,CAAC;AACrB,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;AACjE,wBAAwB;AACxB,GAAG,CAAC,GAAG,CAAC,iBAAiB,EAAE,UAAU,GAAG,EAAE,GAAG;IACzC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC1B,CAAC,CAAC,CAAC;AAEH,GAAG,CAAC,GAAG,CAAC,wBAAwB,EAAE,UAAU,GAAG,EAAE,GAAG;IAChD,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;IACtC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC1B,CAAC,CAAC,CAAC;AACH,GAAG,CAAC,IAAI,CAAC,wBAAwB,EAAE,UAAU,GAAG,EAAE,GAAG;IACjD,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;IACxC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC1B,CAAC,CAAC,CAAC;AACH,GAAG,CAAC,IAAI,CAAC,wBAAwB,EAAE,UAAU,GAAG,EAAE,GAAG;IACjD,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;IACvC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC1B,CAAC,CAAC,CAAC;AAEH,IAAI,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;AACpC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC","file":"server.js","sourcesContent":["\r\nvar schedule = require('node-schedule');\r\nimport http = require('http');\r\nimport https = require('https');\r\nvar Stream = require('stream').Transform;\r\nvar express = require(\"express\");\r\nimport { router } from 'nodedata/core/exports';\r\nimport { Decorators } from 'nodedata/core/constants/decorators';\r\nimport { MetaUtils } from \"nodedata/core/metadata/utils\";\r\nimport * as config from './config';\r\nimport * as securityConfig from './security-config';\r\nimport * as fs from \"fs\";\r\nimport * as data from 'nodedata/mongoose';\r\n\r\nvar passport = require('passport'), LocalStrategy = require('passport-local').Strategy;\r\nconfig.passportSet.setPassport(passport);\r\nimport { Container } from 'nodedata/di';\r\nvar Main = require('nodedata/core');\r\nvar seqData = require(\"nodedata/sequelizeimp\");\r\nMain(config, securityConfig, __dirname, null, seqData.sequelizeService);\r\nimport * as Enumerable from 'linq';\r\n//data.connect();\r\n//data.generateSchema();\r\n\r\nseqData.sequelizeService.connect();\r\nseqData.generateSchema();\r\n\r\nrequire('reflect-metadata/Reflect');\r\nvar bodyParser = require(\"body-parser\");\r\nprocess.env.APP_ROOT = \"hello\";\r\n\r\nvar app = express();\r\nMain.register(app);\r\n\r\nvar path = require('path');\r\napp.use(require('morgan')('combined'));\r\napp.use(require('cookie-parser')());\r\napp.set('views', __dirname + '/views');\r\napp.set('view engine', 'ejs');\r\n\r\nvar expressSession = require('express-session');\r\napp.use(expressSession({ secret: 'mySecretKey', resave: false, saveUninitialized: false }));\r\napp.use(bodyParser.json({limit: '50mb'}));\r\napp.use(bodyParser.urlencoded({\r\n    limit: '50mb',\r\n    extended: true\r\n}));\r\napp.use(function (req, res, next) {\r\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\r\n    res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE,PATCH');\r\n    res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept, Authorization, dd, RequestVerificationToken,UserExecutionContext\");\r\n    res.header(\"Access-Control-Allow-Credentials\", \"true\");\r\n    res.removeHeader(\"x-powered-by\");\r\n    if ('OPTIONS' === req.method) {\r\n        res.send(200);\r\n    } else {\r\n        next();\r\n    }\r\n});\r\n\r\napp.get(\"/extract\", function (req: any, res: any) {\r\n    fs.readFile(\"./imageurls.json\", function (err: NodeJS.ErrnoException, data: Buffer) {\r\n        let dataStr = data.toString();\r\n        let allImageUrls = JSON.parse(dataStr);\r\n        allImageUrls = allImageUrls.imageurls;\r\n        allImageUrls.forEach((url,index) => {\r\n            https.request(url, function (response) {\r\n                var data = new Stream();\r\n                response.on('data', function (chunk) {\r\n                    data.push(chunk);\r\n                });\r\n                response.on('end', function () {\r\n                    var str = url;\r\n                    var final = str.substr(str.lastIndexOf('/') + 1);\r\n                    let filePath = './public/images/' + final;\r\n                    fs.writeFileSync(filePath, data.read());\r\n                });\r\n            }).end();\r\n        });\r\n    });\r\n});\r\n\r\n// app.get('/auth/facebook', passport.authenticate('facebook', { \r\n//     scope : ['public_profile', 'email']\r\n//   }));\r\n\r\n\r\npassport.serializeUser((user, cb) => {\r\n    cb(null, user._id);\r\n});\r\n\r\n\r\npassport.deserializeUser((id, cb) => {\r\n    this.userDetailService.loadUserById(id).\r\n        then(\r\n        (user) => {\r\n            cb(null, user.getUserObject());\r\n        },\r\n        (err) => {\r\n            return cb(err);\r\n        }\r\n        );\r\n\r\n});\r\n\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\napp.use(\"/\", router);\r\napp.use(\"/data\", express.static(path.join(__dirname, 'public')));\r\n/*Facebook Login Page */\r\napp.get('/login/facebook', function (req, res) {\r\n    res.render('fbLogin');\r\n});\r\n\r\napp.get('/data/response/payment', function (req, res) {\r\n    console.log('payment page requested');\r\n    res.render('payment');\r\n});\r\napp.post('/data/response/failure', function (req, res) {\r\n    console.log('failure url payment page');\r\n    res.render('payment');\r\n});\r\napp.post('/data/response/success', function (req, res) {\r\n    console.log('succes url payment page');\r\n    res.render('payment');\r\n});\r\n\r\nvar server = http.createServer(app);\r\nserver.listen(9900);\r\n"],"sourceRoot":"/source/"}